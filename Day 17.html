<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
  </head>
  <body>
    <script>
      const data = [
        2,
        330,
        331,
        332,
        109,
        3448,
        1101,
        0,
        1182,
        16,
        1101,
        0,
        1439,
        24,
        101,
        0,
        0,
        570,
        1006,
        570,
        36,
        102,
        1,
        571,
        0,
        1001,
        570,
        -1,
        570,
        1001,
        24,
        1,
        24,
        1105,
        1,
        18,
        1008,
        571,
        0,
        571,
        1001,
        16,
        1,
        16,
        1008,
        16,
        1439,
        570,
        1006,
        570,
        14,
        21102,
        58,
        1,
        0,
        1105,
        1,
        786,
        1006,
        332,
        62,
        99,
        21102,
        1,
        333,
        1,
        21101,
        73,
        0,
        0,
        1106,
        0,
        579,
        1102,
        1,
        0,
        572,
        1102,
        1,
        0,
        573,
        3,
        574,
        101,
        1,
        573,
        573,
        1007,
        574,
        65,
        570,
        1005,
        570,
        151,
        107,
        67,
        574,
        570,
        1005,
        570,
        151,
        1001,
        574,
        -64,
        574,
        1002,
        574,
        -1,
        574,
        1001,
        572,
        1,
        572,
        1007,
        572,
        11,
        570,
        1006,
        570,
        165,
        101,
        1182,
        572,
        127,
        1002,
        574,
        1,
        0,
        3,
        574,
        101,
        1,
        573,
        573,
        1008,
        574,
        10,
        570,
        1005,
        570,
        189,
        1008,
        574,
        44,
        570,
        1006,
        570,
        158,
        1105,
        1,
        81,
        21102,
        340,
        1,
        1,
        1105,
        1,
        177,
        21101,
        0,
        477,
        1,
        1105,
        1,
        177,
        21102,
        514,
        1,
        1,
        21102,
        176,
        1,
        0,
        1105,
        1,
        579,
        99,
        21101,
        184,
        0,
        0,
        1106,
        0,
        579,
        4,
        574,
        104,
        10,
        99,
        1007,
        573,
        22,
        570,
        1006,
        570,
        165,
        101,
        0,
        572,
        1182,
        21101,
        0,
        375,
        1,
        21101,
        0,
        211,
        0,
        1105,
        1,
        579,
        21101,
        1182,
        11,
        1,
        21102,
        1,
        222,
        0,
        1106,
        0,
        979,
        21102,
        1,
        388,
        1,
        21101,
        233,
        0,
        0,
        1106,
        0,
        579,
        21101,
        1182,
        22,
        1,
        21101,
        244,
        0,
        0,
        1105,
        1,
        979,
        21102,
        401,
        1,
        1,
        21102,
        255,
        1,
        0,
        1106,
        0,
        579,
        21101,
        1182,
        33,
        1,
        21101,
        266,
        0,
        0,
        1105,
        1,
        979,
        21102,
        1,
        414,
        1,
        21101,
        277,
        0,
        0,
        1105,
        1,
        579,
        3,
        575,
        1008,
        575,
        89,
        570,
        1008,
        575,
        121,
        575,
        1,
        575,
        570,
        575,
        3,
        574,
        1008,
        574,
        10,
        570,
        1006,
        570,
        291,
        104,
        10,
        21101,
        0,
        1182,
        1,
        21102,
        1,
        313,
        0,
        1105,
        1,
        622,
        1005,
        575,
        327,
        1101,
        0,
        1,
        575,
        21102,
        327,
        1,
        0,
        1106,
        0,
        786,
        4,
        438,
        99,
        0,
        1,
        1,
        6,
        77,
        97,
        105,
        110,
        58,
        10,
        33,
        10,
        69,
        120,
        112,
        101,
        99,
        116,
        101,
        100,
        32,
        102,
        117,
        110,
        99,
        116,
        105,
        111,
        110,
        32,
        110,
        97,
        109,
        101,
        32,
        98,
        117,
        116,
        32,
        103,
        111,
        116,
        58,
        32,
        0,
        12,
        70,
        117,
        110,
        99,
        116,
        105,
        111,
        110,
        32,
        65,
        58,
        10,
        12,
        70,
        117,
        110,
        99,
        116,
        105,
        111,
        110,
        32,
        66,
        58,
        10,
        12,
        70,
        117,
        110,
        99,
        116,
        105,
        111,
        110,
        32,
        67,
        58,
        10,
        23,
        67,
        111,
        110,
        116,
        105,
        110,
        117,
        111,
        117,
        115,
        32,
        118,
        105,
        100,
        101,
        111,
        32,
        102,
        101,
        101,
        100,
        63,
        10,
        0,
        37,
        10,
        69,
        120,
        112,
        101,
        99,
        116,
        101,
        100,
        32,
        82,
        44,
        32,
        76,
        44,
        32,
        111,
        114,
        32,
        100,
        105,
        115,
        116,
        97,
        110,
        99,
        101,
        32,
        98,
        117,
        116,
        32,
        103,
        111,
        116,
        58,
        32,
        36,
        10,
        69,
        120,
        112,
        101,
        99,
        116,
        101,
        100,
        32,
        99,
        111,
        109,
        109,
        97,
        32,
        111,
        114,
        32,
        110,
        101,
        119,
        108,
        105,
        110,
        101,
        32,
        98,
        117,
        116,
        32,
        103,
        111,
        116,
        58,
        32,
        43,
        10,
        68,
        101,
        102,
        105,
        110,
        105,
        116,
        105,
        111,
        110,
        115,
        32,
        109,
        97,
        121,
        32,
        98,
        101,
        32,
        97,
        116,
        32,
        109,
        111,
        115,
        116,
        32,
        50,
        48,
        32,
        99,
        104,
        97,
        114,
        97,
        99,
        116,
        101,
        114,
        115,
        33,
        10,
        94,
        62,
        118,
        60,
        0,
        1,
        0,
        -1,
        -1,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        40,
        18,
        0,
        109,
        4,
        2101,
        0,
        -3,
        587,
        20101,
        0,
        0,
        -1,
        22101,
        1,
        -3,
        -3,
        21101,
        0,
        0,
        -2,
        2208,
        -2,
        -1,
        570,
        1005,
        570,
        617,
        2201,
        -3,
        -2,
        609,
        4,
        0,
        21201,
        -2,
        1,
        -2,
        1105,
        1,
        597,
        109,
        -4,
        2105,
        1,
        0,
        109,
        5,
        1201,
        -4,
        0,
        629,
        21002,
        0,
        1,
        -2,
        22101,
        1,
        -4,
        -4,
        21101,
        0,
        0,
        -3,
        2208,
        -3,
        -2,
        570,
        1005,
        570,
        781,
        2201,
        -4,
        -3,
        653,
        20101,
        0,
        0,
        -1,
        1208,
        -1,
        -4,
        570,
        1005,
        570,
        709,
        1208,
        -1,
        -5,
        570,
        1005,
        570,
        734,
        1207,
        -1,
        0,
        570,
        1005,
        570,
        759,
        1206,
        -1,
        774,
        1001,
        578,
        562,
        684,
        1,
        0,
        576,
        576,
        1001,
        578,
        566,
        692,
        1,
        0,
        577,
        577,
        21102,
        1,
        702,
        0,
        1106,
        0,
        786,
        21201,
        -1,
        -1,
        -1,
        1105,
        1,
        676,
        1001,
        578,
        1,
        578,
        1008,
        578,
        4,
        570,
        1006,
        570,
        724,
        1001,
        578,
        -4,
        578,
        21102,
        1,
        731,
        0,
        1106,
        0,
        786,
        1105,
        1,
        774,
        1001,
        578,
        -1,
        578,
        1008,
        578,
        -1,
        570,
        1006,
        570,
        749,
        1001,
        578,
        4,
        578,
        21101,
        0,
        756,
        0,
        1105,
        1,
        786,
        1106,
        0,
        774,
        21202,
        -1,
        -11,
        1,
        22101,
        1182,
        1,
        1,
        21101,
        0,
        774,
        0,
        1106,
        0,
        622,
        21201,
        -3,
        1,
        -3,
        1105,
        1,
        640,
        109,
        -5,
        2105,
        1,
        0,
        109,
        7,
        1005,
        575,
        802,
        20101,
        0,
        576,
        -6,
        20101,
        0,
        577,
        -5,
        1106,
        0,
        814,
        21101,
        0,
        0,
        -1,
        21101,
        0,
        0,
        -5,
        21101,
        0,
        0,
        -6,
        20208,
        -6,
        576,
        -2,
        208,
        -5,
        577,
        570,
        22002,
        570,
        -2,
        -2,
        21202,
        -5,
        41,
        -3,
        22201,
        -6,
        -3,
        -3,
        22101,
        1439,
        -3,
        -3,
        1201,
        -3,
        0,
        843,
        1005,
        0,
        863,
        21202,
        -2,
        42,
        -4,
        22101,
        46,
        -4,
        -4,
        1206,
        -2,
        924,
        21101,
        1,
        0,
        -1,
        1106,
        0,
        924,
        1205,
        -2,
        873,
        21102,
        1,
        35,
        -4,
        1106,
        0,
        924,
        2102,
        1,
        -3,
        878,
        1008,
        0,
        1,
        570,
        1006,
        570,
        916,
        1001,
        374,
        1,
        374,
        1202,
        -3,
        1,
        895,
        1102,
        1,
        2,
        0,
        2101,
        0,
        -3,
        902,
        1001,
        438,
        0,
        438,
        2202,
        -6,
        -5,
        570,
        1,
        570,
        374,
        570,
        1,
        570,
        438,
        438,
        1001,
        578,
        558,
        922,
        20102,
        1,
        0,
        -4,
        1006,
        575,
        959,
        204,
        -4,
        22101,
        1,
        -6,
        -6,
        1208,
        -6,
        41,
        570,
        1006,
        570,
        814,
        104,
        10,
        22101,
        1,
        -5,
        -5,
        1208,
        -5,
        49,
        570,
        1006,
        570,
        810,
        104,
        10,
        1206,
        -1,
        974,
        99,
        1206,
        -1,
        974,
        1102,
        1,
        1,
        575,
        21101,
        973,
        0,
        0,
        1105,
        1,
        786,
        99,
        109,
        -7,
        2106,
        0,
        0,
        109,
        6,
        21102,
        0,
        1,
        -4,
        21102,
        0,
        1,
        -3,
        203,
        -2,
        22101,
        1,
        -3,
        -3,
        21208,
        -2,
        82,
        -1,
        1205,
        -1,
        1030,
        21208,
        -2,
        76,
        -1,
        1205,
        -1,
        1037,
        21207,
        -2,
        48,
        -1,
        1205,
        -1,
        1124,
        22107,
        57,
        -2,
        -1,
        1205,
        -1,
        1124,
        21201,
        -2,
        -48,
        -2,
        1106,
        0,
        1041,
        21101,
        0,
        -4,
        -2,
        1105,
        1,
        1041,
        21101,
        -5,
        0,
        -2,
        21201,
        -4,
        1,
        -4,
        21207,
        -4,
        11,
        -1,
        1206,
        -1,
        1138,
        2201,
        -5,
        -4,
        1059,
        2101,
        0,
        -2,
        0,
        203,
        -2,
        22101,
        1,
        -3,
        -3,
        21207,
        -2,
        48,
        -1,
        1205,
        -1,
        1107,
        22107,
        57,
        -2,
        -1,
        1205,
        -1,
        1107,
        21201,
        -2,
        -48,
        -2,
        2201,
        -5,
        -4,
        1090,
        20102,
        10,
        0,
        -1,
        22201,
        -2,
        -1,
        -2,
        2201,
        -5,
        -4,
        1103,
        2101,
        0,
        -2,
        0,
        1105,
        1,
        1060,
        21208,
        -2,
        10,
        -1,
        1205,
        -1,
        1162,
        21208,
        -2,
        44,
        -1,
        1206,
        -1,
        1131,
        1106,
        0,
        989,
        21101,
        439,
        0,
        1,
        1106,
        0,
        1150,
        21101,
        0,
        477,
        1,
        1106,
        0,
        1150,
        21101,
        0,
        514,
        1,
        21101,
        1149,
        0,
        0,
        1105,
        1,
        579,
        99,
        21102,
        1157,
        1,
        0,
        1106,
        0,
        579,
        204,
        -2,
        104,
        10,
        99,
        21207,
        -3,
        22,
        -1,
        1206,
        -1,
        1138,
        2102,
        1,
        -5,
        1176,
        1201,
        -4,
        0,
        0,
        109,
        -6,
        2106,
        0,
        0,
        0,
        7,
        34,
        1,
        5,
        1,
        34,
        1,
        5,
        1,
        34,
        1,
        5,
        1,
        34,
        1,
        5,
        1,
        34,
        1,
        5,
        1,
        34,
        1,
        5,
        1,
        23,
        5,
        6,
        1,
        5,
        1,
        23,
        1,
        3,
        1,
        6,
        1,
        5,
        1,
        23,
        1,
        3,
        1,
        6,
        1,
        5,
        1,
        23,
        1,
        3,
        1,
        6,
        11,
        17,
        11,
        8,
        1,
        3,
        1,
        17,
        1,
        1,
        1,
        3,
        1,
        3,
        1,
        8,
        7,
        11,
        7,
        3,
        1,
        3,
        1,
        12,
        1,
        1,
        1,
        11,
        1,
        3,
        1,
        5,
        1,
        3,
        1,
        12,
        1,
        1,
        1,
        11,
        1,
        3,
        1,
        5,
        1,
        3,
        1,
        12,
        1,
        1,
        1,
        11,
        1,
        3,
        1,
        5,
        1,
        3,
        1,
        12,
        7,
        7,
        1,
        1,
        13,
        14,
        1,
        3,
        1,
        7,
        1,
        1,
        1,
        1,
        1,
        5,
        1,
        18,
        13,
        1,
        1,
        1,
        1,
        5,
        7,
        16,
        1,
        9,
        1,
        1,
        1,
        28,
        1,
        5,
        7,
        28,
        1,
        5,
        1,
        3,
        1,
        30,
        1,
        3,
        7,
        30,
        1,
        3,
        1,
        1,
        1,
        34,
        1,
        3,
        1,
        1,
        1,
        34,
        1,
        3,
        1,
        1,
        1,
        28,
        13,
        28,
        1,
        5,
        1,
        3,
        1,
        30,
        1,
        5,
        5,
        30,
        1,
        40,
        7,
        40,
        1,
        40,
        1,
        1,
        1,
        38,
        1,
        1,
        1,
        38,
        1,
        1,
        1,
        38,
        1,
        1,
        1,
        38,
        7,
        36,
        1,
        3,
        1,
        36,
        11,
        34,
        1,
        5,
        1,
        34,
        1,
        5,
        1,
        34,
        1,
        5,
        1,
        34,
        1,
        5,
        1,
        34,
        1,
        5,
        1,
        34,
        1,
        5,
        1,
        34,
        1,
        5,
        1,
        34,
        1,
        5,
        1,
        34,
        1,
        5,
        1,
        34,
        7,
        12
      ];
      let board = [];
      let message = [];
      let boardEnd = false;
      let char;
      let index = 0;
      let input;
      let main = "A,B,B,C,A,B,C,A,B,C\n";
      let A = "L,6,R,12,L,4,L,6\n";
      let B = "R,6,L,6,R,12\n";
      let C = "L,6,L,10,L,10,R,6\n";
      let yes = "y\n";
      opcode(data);
      let map = String.fromCodePoint(...board);
      let mapArray = map.split("\n");
      console.log(map);
      let sum = findSum(mapArray);
      console.log(sum);
      let robot = findRobot(mapArray);
      console.log(robot);
      findPath(mapArray, robot);
      function opcode(data) {
        let data2 = [].concat(data);
        let relativeBase = 0;
        const length = data2.length;
        for (let i = 0; i < data2.length; ) {
          let code = String(data2[i]);
          if (code.length < 2) code = "0" + code;
          let paramMode1 = +code.slice(-3, -2);
          let paramMode2 = +code.slice(-4, -3);
          let paramMode3 = +code.slice(-5, -4);
          let index1 = getIndex(paramMode1, 1);
          let index2 = getIndex(paramMode2, 2);
          let index3 = getIndex(paramMode3, 3);
          let param1 = data2[index1];
          if (param1 === undefined && index1 > length - 1) {
            data2[index1] = index1 - length;
            param1 = data2[index1];
          }
          let param2 = data2[index2];
          if (param2 === undefined && index2 > length - 1) {
            data2[index2] = index2 - length;
            param2 = data2[index2];
          }
          code = code.slice(-2);
          switch (code) {
            case "01":
              data2[index3] = param1 + param2;
              i += 4;
              break;
            case "02":
              data2[index3] = param1 * param2;
              i += 4;
              break;
            case "03":
              data2[index1] = input.charCodeAt(index);
              index++;
              i += 2;
              break;
            case "04":
              drawBoard(param1);
              i += 2;
              break;
            case "05":
              if (param1) i = param2;
              else i += 3;
              break;
            case "06":
              if (!param1) i = param2;
              else i += 3;
              break;
            case "07":
              data2[index3] = param1 < param2 ? 1 : 0;
              i += 4;
              break;
            case "08":
              data2[index3] = param1 == param2 ? 1 : 0;
              i += 4;
              break;
            case "09":
              relativeBase += param1;
              i += 2;
              break;
            case "99":
              return;
          }
          function getIndex(mode, shift) {
            switch (mode) {
              case 0:
                return data2[i + shift];
              case 1:
                return i + shift;
              case 2:
                return relativeBase + data2[i + shift];
            }
          }
        }
      }
      function drawBoard(output) {
        if (char == 10 && output == 10) {
          boardEnd = true;
          return;
        }
        char = output;
        if (!boardEnd) {
          board.push(output);
        }
        if (boardEnd) {
          if (output == 10) {
            let messageStr = String.fromCodePoint(...message);
            console.log(messageStr);
            if (messageStr == "Main:") input = main;
            if (messageStr == "Function A:") input = A;
            if (messageStr == "Function B:") input = B;
            if (messageStr == "Function C:") input = C;
            if (messageStr == "Continuous video feed?") input = yes;
            message = [];
          } else {
            message.push(output);
            if (output > 200) console.log(output);
          }
        }
        index = 0;
      }
      function findSum(board) {
        let sum = 0;
        for (let i = 1; i < board.length - 1; i++) {
          for (let j = 1; j < board[i].length - 1; j++) {
            if (board[i][j] == "#") {
              if (checkNeighbors(board, i, j)) {
                sum += j * i;
              }
            }
          }
        }
        return sum;
      }
      function checkNeighbors(board, i, j) {
        if (board[i - 1][j] == ".") return false;
        if (board[i + 1][j] == ".") return false;
        if (board[i][j - 1] == ".") return false;
        if (board[i][j + 1] == ".") return false;
        return true;
      }
      function findRobot(board) {
        for (let i = 0; i < board.length; i++) {
          for (let j = 0; j < board[i].length; j++) {
            if (board[i][j] == "^") return `${j},${i}`;
          }
        }
      }
      function findPath(board, robot) {
        let path = "";
        let [x, y] = robot.split(",");
        let direction = "up";
        while (true) {
          let line = createLine();
          if (line == undefined) break;
          path += line;
        }
        let a = path.replace(/L6R12L4L6/g, "A");
        let b = a.replace(/R6L6R12/g, "B");
        let c = b.replace(/L6L10L10R6/g, "C");
        console.log(path);
        console.log(c);
        function createLine() {
          let line = "";
          let i = 0;
          switch (direction) {
            case "up":
              if (board[y][+x - 1] == "#") {
                line += "L";
                direction = "left";
                while (board[y][+x - 1] == "#") {
                  i++;
                  x--;
                }
                line += i;
              } else if (board[y][+x + 1] == "#") {
                line += "R";
                direction = "right";
                while (board[y][+x + 1] == "#") {
                  i++;
                  x++;
                }
                line += i;
              } else return;
              break;
            case "right":
              if (board[+y + 1][x] == "#") {
                line += "R";
                direction = "down";
                while (board[+y + 1][x] == "#") {
                  i++;
                  y++;
                }
                line += i;
              } else if (board[+y - 1][x] == "#") {
                line += "L";
                direction = "up";
                while (board[+y - 1][x] == "#") {
                  i++;
                  y--;
                }
                line += i;
              } else return;
              break;
            case "down":
              if (board[y][+x - 1] == "#") {
                line += "R";
                direction = "left";
                while (board[y][+x - 1] == "#") {
                  i++;
                  x--;
                }
                line += i;
              } else if (board[y][+x + 1] == "#") {
                line += "L";
                direction = "right";
                while (board[y][+x + 1] == "#") {
                  i++;
                  x++;
                }
                line += i;
              } else return;
              break;
            case "left":
              if (board[+y + 1][x] == "#") {
                line += "L";
                direction = "down";
                while (board[+y + 1][x] == "#") {
                  i++;
                  y++;
                }
                line += i;
              } else if (board[+y - 1][x] == "#") {
                line += "R";
                direction = "up";
                while (board[+y - 1] != undefined && board[+y - 1][x] == "#") {
                  i++;
                  y--;
                }
                line += i;
              } else return;
              break;
          }
          return line;
        }
      }
    </script>
  </body>
</html>
