<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
  </head>
  <body>
    <script>
      const data = [
        3,
        8,
        1005,
        8,
        330,
        1106,
        0,
        11,
        0,
        0,
        0,
        104,
        1,
        104,
        0,
        3,
        8,
        102,
        -1,
        8,
        10,
        1001,
        10,
        1,
        10,
        4,
        10,
        108,
        0,
        8,
        10,
        4,
        10,
        1001,
        8,
        0,
        28,
        1,
        1103,
        17,
        10,
        1006,
        0,
        99,
        1006,
        0,
        91,
        1,
        102,
        7,
        10,
        3,
        8,
        1002,
        8,
        -1,
        10,
        101,
        1,
        10,
        10,
        4,
        10,
        108,
        1,
        8,
        10,
        4,
        10,
        1002,
        8,
        1,
        64,
        3,
        8,
        102,
        -1,
        8,
        10,
        1001,
        10,
        1,
        10,
        4,
        10,
        108,
        0,
        8,
        10,
        4,
        10,
        102,
        1,
        8,
        86,
        2,
        4,
        0,
        10,
        1006,
        0,
        62,
        2,
        1106,
        13,
        10,
        3,
        8,
        1002,
        8,
        -1,
        10,
        1001,
        10,
        1,
        10,
        4,
        10,
        1008,
        8,
        0,
        10,
        4,
        10,
        101,
        0,
        8,
        120,
        1,
        1109,
        1,
        10,
        1,
        105,
        5,
        10,
        3,
        8,
        102,
        -1,
        8,
        10,
        1001,
        10,
        1,
        10,
        4,
        10,
        108,
        1,
        8,
        10,
        4,
        10,
        1002,
        8,
        1,
        149,
        1,
        108,
        7,
        10,
        1006,
        0,
        40,
        1,
        6,
        0,
        10,
        2,
        8,
        9,
        10,
        3,
        8,
        102,
        -1,
        8,
        10,
        1001,
        10,
        1,
        10,
        4,
        10,
        1008,
        8,
        1,
        10,
        4,
        10,
        1002,
        8,
        1,
        187,
        1,
        1105,
        10,
        10,
        3,
        8,
        102,
        -1,
        8,
        10,
        1001,
        10,
        1,
        10,
        4,
        10,
        1008,
        8,
        1,
        10,
        4,
        10,
        1002,
        8,
        1,
        213,
        1006,
        0,
        65,
        1006,
        0,
        89,
        1,
        1003,
        14,
        10,
        3,
        8,
        102,
        -1,
        8,
        10,
        1001,
        10,
        1,
        10,
        4,
        10,
        108,
        0,
        8,
        10,
        4,
        10,
        102,
        1,
        8,
        244,
        2,
        1106,
        14,
        10,
        1006,
        0,
        13,
        3,
        8,
        102,
        -1,
        8,
        10,
        1001,
        10,
        1,
        10,
        4,
        10,
        108,
        0,
        8,
        10,
        4,
        10,
        1001,
        8,
        0,
        273,
        3,
        8,
        1002,
        8,
        -1,
        10,
        1001,
        10,
        1,
        10,
        4,
        10,
        108,
        1,
        8,
        10,
        4,
        10,
        1001,
        8,
        0,
        295,
        1,
        104,
        4,
        10,
        2,
        108,
        20,
        10,
        1006,
        0,
        94,
        1006,
        0,
        9,
        101,
        1,
        9,
        9,
        1007,
        9,
        998,
        10,
        1005,
        10,
        15,
        99,
        109,
        652,
        104,
        0,
        104,
        1,
        21102,
        937268450196,
        1,
        1,
        21102,
        1,
        347,
        0,
        1106,
        0,
        451,
        21101,
        387512636308,
        0,
        1,
        21102,
        358,
        1,
        0,
        1105,
        1,
        451,
        3,
        10,
        104,
        0,
        104,
        1,
        3,
        10,
        104,
        0,
        104,
        0,
        3,
        10,
        104,
        0,
        104,
        1,
        3,
        10,
        104,
        0,
        104,
        1,
        3,
        10,
        104,
        0,
        104,
        0,
        3,
        10,
        104,
        0,
        104,
        1,
        21101,
        0,
        97751428099,
        1,
        21102,
        1,
        405,
        0,
        1105,
        1,
        451,
        21102,
        1,
        179355806811,
        1,
        21101,
        416,
        0,
        0,
        1106,
        0,
        451,
        3,
        10,
        104,
        0,
        104,
        0,
        3,
        10,
        104,
        0,
        104,
        0,
        21102,
        1,
        868389643008,
        1,
        21102,
        439,
        1,
        0,
        1105,
        1,
        451,
        21102,
        1,
        709475853160,
        1,
        21102,
        450,
        1,
        0,
        1105,
        1,
        451,
        99,
        109,
        2,
        22102,
        1,
        -1,
        1,
        21101,
        0,
        40,
        2,
        21101,
        482,
        0,
        3,
        21102,
        1,
        472,
        0,
        1105,
        1,
        515,
        109,
        -2,
        2106,
        0,
        0,
        0,
        1,
        0,
        0,
        1,
        109,
        2,
        3,
        10,
        204,
        -1,
        1001,
        477,
        478,
        493,
        4,
        0,
        1001,
        477,
        1,
        477,
        108,
        4,
        477,
        10,
        1006,
        10,
        509,
        1101,
        0,
        0,
        477,
        109,
        -2,
        2105,
        1,
        0,
        0,
        109,
        4,
        2101,
        0,
        -1,
        514,
        1207,
        -3,
        0,
        10,
        1006,
        10,
        532,
        21101,
        0,
        0,
        -3,
        21202,
        -3,
        1,
        1,
        22101,
        0,
        -2,
        2,
        21101,
        1,
        0,
        3,
        21101,
        0,
        551,
        0,
        1105,
        1,
        556,
        109,
        -4,
        2106,
        0,
        0,
        109,
        5,
        1207,
        -3,
        1,
        10,
        1006,
        10,
        579,
        2207,
        -4,
        -2,
        10,
        1006,
        10,
        579,
        22102,
        1,
        -4,
        -4,
        1105,
        1,
        647,
        21201,
        -4,
        0,
        1,
        21201,
        -3,
        -1,
        2,
        21202,
        -2,
        2,
        3,
        21101,
        0,
        598,
        0,
        1106,
        0,
        556,
        22101,
        0,
        1,
        -4,
        21102,
        1,
        1,
        -1,
        2207,
        -4,
        -2,
        10,
        1006,
        10,
        617,
        21101,
        0,
        0,
        -1,
        22202,
        -2,
        -1,
        -2,
        2107,
        0,
        -3,
        10,
        1006,
        10,
        639,
        22102,
        1,
        -1,
        1,
        21102,
        1,
        639,
        0,
        105,
        1,
        514,
        21202,
        -2,
        -1,
        -2,
        22201,
        -4,
        -2,
        -4,
        109,
        -5,
        2105,
        1,
        0
      ];
      let input = 1;
      let board = { "0,0": 1 };
      let robot = { direction: "up", position: "0,0" };
      opcode(data);
      console.log(Object.keys(board).length);
      let [minX, minY, maxX, maxY] = [0, 0, 0, 0];
      for (let coord in board) {
        let [x, y] = coord.split(",");
        if (+x < minX) minX = +x;
        if (+y < minY) minY = +y;
        if (+x > maxX) maxX = +x;
        if (+y > maxY) maxY = +y;
      }
      const width = maxX - minX + 1;
      const height = maxY - minY + 1;
      const canvas = document.createElement("canvas");
      canvas.width = width * 5;
      canvas.height = height * 5;
      canvas.id = "canvas";
      document.body.append(canvas);
      const ctx = canvas.getContext("2d");
      for (let i = 0; i < height; i++) {
        for (let j = 0; j < width; j++) {
          if (board[`${j + minX},${i + minY}`] == 1) {
            ctx.fillStyle = "black";
            ctx.fillRect(j * 5, (height - i - 1) * 5, 5, 5);
          }
        }
      }
      function opcode(data) {
        let data2 = [].concat(data);
        let relativeBase = 0;
        const length = data2.length;
        let outputs = [];
        for (let i = 0; i < data2.length; ) {
          let code = String(data2[i]);
          if (code.length < 2) code = "0" + code;
          let paramMode1 = +code.slice(-3, -2);
          let paramMode2 = +code.slice(-4, -3);
          let paramMode3 = +code.slice(-5, -4);
          let index1 = getIndex(paramMode1, 1);
          let index2 = getIndex(paramMode2, 2);
          let index3 = getIndex(paramMode3, 3);
          let param1 = data2[index1];
          if (param1 === undefined && index1 > length - 1) {
            data2[index1] = index1 - length;
            param1 = data2[index1];
          }
          let param2 = data2[index2];
          if (param2 === undefined && index2 > length - 1) {
            data2[index2] = index2 - length;
            param2 = data2[index2];
          }
          code = code.slice(-2);
          switch (code) {
            case "01":
              data2[index3] = param1 + param2;
              i += 4;
              break;
            case "02":
              data2[index3] = param1 * param2;
              i += 4;
              break;
            case "03":
              data2[index1] = input;
              outputs = [];
              i += 2;
              break;
            case "04":
              outputs.push(param1);
              if (outputs.length == 2) drawBoard(outputs);
              i += 2;
              break;
            case "05":
              if (param1) i = param2;
              else i += 3;
              break;
            case "06":
              if (!param1) i = param2;
              else i += 3;
              break;
            case "07":
              data2[index3] = param1 < param2 ? 1 : 0;
              i += 4;
              break;
            case "08":
              data2[index3] = param1 == param2 ? 1 : 0;
              i += 4;
              break;
            case "09":
              relativeBase += param1;
              i += 2;
              break;
            case "99":
              return;
          }
          function getIndex(mode, shift) {
            switch (mode) {
              case 0:
                return data2[i + shift];
              case 1:
                return i + shift;
              case 2:
                return relativeBase + data2[i + shift];
            }
          }
        }
      }
      function drawBoard(outputs) {
        let [color, rotation] = outputs;
        board[robot.position] = color;
        let directions = ["up", "right", "down", "left"];
        let index = directions.indexOf(robot.direction);
        if (rotation == 0) {
          robot.direction = directions[(index + 3) % 4];
        }
        if (rotation == 1) {
          robot.direction = directions[(index + 1) % 4];
        }
        let [x, y] = robot.position.split(",");
        switch (robot.direction) {
          case "up":
            robot.position = `${x},${++y}`;
            break;
          case "right":
            robot.position = `${++x},${y}`;
            break;
          case "down":
            robot.position = `${x},${--y}`;
            break;
          case "left":
            robot.position = `${--x},${y}`;
            break;
        }
        input = board[robot.position] || 0;
      }
    </script>
  </body>
</html>
